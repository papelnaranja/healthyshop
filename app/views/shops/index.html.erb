<%= render 'sidepanel' %>
<div class="page-shop mt-4-rem">

  <% if notice %>
    <div class="alert alert-warning">
      <%= notice %>
    </div>
  <% end %>
  <div style='width: 100wv;'>
    <div id="map" style='width: 100wv; height: calc(100vh - 100px);'  ></div>
  </div>

  <% if current_user.role == 'admin' %>
  <%= render 'all-shops' %>
  <% else %>
  <%= render 'my-shops' %>
  <% end %>
    

  <div id="tiendas">

  </div>


</div>
<script>


$(document).on('turbolinks:load', function () {



function displayOnMap(position){
  var Marker = handler.addMarker({
    lat: position.coords.latitude,
    lng: position.coords.longitude,
    picture: {
        url: "<%= asset_path('icon-mini.png') %>",
        width:  36,
        height: 36
    },
  });
  handler.map.centerOn(Marker);
  console.log('More or less ' + position.coords.accuracy + ' meters.');
  console.log(Marker)
};
    

handler = Gmaps.build('Google');
//currentPosition();
handler.buildMap({
    disableDefaultUI: true,
    provider: {
      center: new google.maps.LatLng({lat: -33, lng: -70}),
      zoom: 15
    },
    internal: {
      id: 'map'
    }
    
    
},
  function(){
    
    if(navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(displayOnMap)
    }
    markers = handler.addMarkers(<%= raw @hash.to_json %>);
    google.maps.event.addListener(handler.getMap(), "click", function(event){
      var latitude = event.latLng.lat();
      var longitude = event.latLng.lng();      
      console.log(latitude, longitude);
      $('#shop_longitude').val(longitude);
      $('#shop_latitude').val(latitude);
      addMarker(event.latLng);
      console.log(event.latLng)
    });

  }
);


// Este c√≥digo permite marcar solo un punto.
var userMarker;
function addMarker(location) {
  if (userMarker) {
    userMarker.setPosition(location);
  } else {
    userMarker = new google.maps.Marker({
      position: location,
      map: handler.getMap()
    });
  }

}

});


  $('[name="q"]').keyup(function (e) { 
    $.ajax({
      type: "get",
      url: "<%= shops_url %>",
      data: {q : $(this).val()},
      dataType: "json",
      success: function (response) {
        
      }
    });
    console.log()
});

</script>